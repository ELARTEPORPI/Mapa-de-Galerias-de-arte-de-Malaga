<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mapa de Galer칤as de Arte - Multilenguaje</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>


/* Envolver los elementos en un contenedor fijo arriba */
#top-ui {
  position: fixed;
  top: 0;
  width: 100%;
  
  background: #f7f7f7;
  z-index: 1000;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  font-size: 14px;
}

/* Mensaje de actualizaci칩n */
#update-date {
  text-align: center;
  font-size: 0.85em;
  color: #555;
  padding: 6px 0 4px;
}

/* Fila con selector + botones */
#selector-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 8px 6px;
}

/* Botones laterales */
#zoom-toggle,
#toggle-language {
  background: white;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 4px 8px;
  font-weight: bold;
  cursor: pointer;
}

/* Contenedor del selector */
#gallery-select-container {
  flex: 1;
  margin: 0 8px;
}

/* Selector */
.gallery-select {
  width: 100%;
  padding: 4px 8px;
  font-size: 14px;
}

/* Ocultar label visualmente pero mantener accesibilidad */
.visually-hidden {
  position: absolute !important;
  height: 1px; width: 1px;
  overflow: hidden;
  clip: rect(1px, 1px, 1px, 1px);
  white-space: nowrap;
}

/* Ajustar el mapa para no solaparlo con top-ui */
#map {
  position: absolute;
  top: 70px;  /* ajusta seg칰n altura real del top-ui */
  bottom: 0;
  width: 100%;
}
</style>
</head>
<body>

<!-- Contenedor fijo arriba con actualizaci칩n y selector -->
<div id="top-ui">
  <div id="update-date">
    칔ltima actualizaci칩n: <span id="last-update"></span>
  </div>

  <div id="selector-bar">
    <button id="zoom-toggle">游댌</button>

    <div id="gallery-select-container">
      <label for="gallery-select" class="visually-hidden">Selecciona una galer칤a:</label>
      <select id="gallery-select" class="gallery-select">
        <option value="">-- Elige una galer칤a --</option>
      </select>
    </div>

    <button id="toggle-language">EN</button>
  </div>
</div>

<!-- Mapa -->
<div id="map"></div>


<!-- Scripts -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Crear mapa y capa base
  const map = L.map('map').setView([36.7213, -4.4214], 13);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap contributors & CartoDB',
    maxZoom: 19,
  }).addTo(map);

  // Textos para los idiomas
  const texts = {
    es: {
      selectLabel: "Selecciona una galer칤a:",
      selectOption: "-- Elige una galer칤a --",
      lastUpdate: "칔ltima actualizaci칩n:",
      locale: "es-ES"
    },
    en: {
      selectLabel: "Select a gallery:",
      selectOption: "-- Choose a gallery --",
      lastUpdate: "Last update:",
      locale: "en-US"
    }
  };

  let currentLang = 'es';  // Define idioma por defecto

  // 丘멆잺 Aseg칰rate de que estas referencias existan antes de usarlas
  const toggleBtn = document.getElementById('toggle-language');
  const gallerySelectLabel = document.querySelector('label[for="gallery-select"]');
  const gallerySelect = document.getElementById('gallery-select');
  const lastUpdateDiv = document.getElementById('update-date');

  // Actualizar textos est치ticos
  function updateStaticTexts() {
    const t = texts[currentLang];
    gallerySelectLabel.textContent = t.selectLabel;

    if (gallerySelect.options.length > 0) {
      gallerySelect.options[0].textContent = t.selectOption;
    }

    const fecha = new Date();
    const opcionesFecha = { year: 'numeric', month: 'long', day: 'numeric' };
    const fechaFormateada = fecha.toLocaleDateString(t.locale, opcionesFecha);

    lastUpdateDiv.innerHTML = `${t.lastUpdate} <span id="last-update">${fechaFormateada}</span>`;
  }

// Cambiar idioma al hacer clic en el bot칩n
toggleBtn.addEventListener('click', () => {
  currentLang = currentLang === 'es' ? 'en' : 'es';

  updateStaticTexts();

  // Actualizar texto ubicaci칩n usuario si existe
  if (userMarker) {
    userMarker.setPopupContent(currentLang === 'es' ? "Tu ubicaci칩n" : "Your location");
  }

  // Si hay popup abierto, actualizar su contenido para el idioma nuevo
  const openPopup = map._popup;
  if (openPopup && openPopup.isOpen()) {
    const marker = openPopup._source;
    // Buscar 칤ndice del marker para acceder a galer칤a
    const idx = window.markers.indexOf(marker);
    if (idx !== -1) {
      openPopup.setContent(
        `<b>${window.galerias[idx].nombre}</b><br>` +
        `<span>${currentLang === 'es' ? window.galerias[idx].descripcion_es : window.galerias[idx].descripcion_en}</span>`
      );
    }
  }

  // Cambiar texto bot칩n
  toggleBtn.textContent = currentLang === 'es' ? 'EN' : 'ES';
});

  updateStaticTexts();

  if (userMarker) {
    userMarker.setPopupContent(currentLang === 'es' ? "Tu ubicaci칩n" : "Your location");
  }
  
</script>



<script>
fetch('galerias.json')
  .then(response => response.json())
  .then(galerias => {
    const markers = [];

    const gallerySelect = document.getElementById('gallery-select');

    // Funci칩n que devuelve el contenido del popup en el idioma actual
    function getPopupContent(galeria) {
      const desc = currentLang === 'es' ? galeria.descripcion_es : galeria.descripcion_en;
      return `<b>${galeria.nombre}</b><br><span>${desc}</span>`;
    }

    galerias.forEach((galeria, index) => {
      const marker = L.marker([galeria.lat, galeria.lng]).addTo(map);

      // Bind popup sin contenido fijo, se actualizar치 al abrirlo
      marker.bindPopup('');

      markers.push(marker);

      const option = document.createElement('option');
      option.value = index;
      option.textContent = galeria.nombre;
      gallerySelect.appendChild(option);
    });

    // Al seleccionar una galer칤a, abrir popup y actualizar contenido
    gallerySelect.addEventListener('change', () => {
      const idx = gallerySelect.value;
      if (idx !== '') {
        const marker = markers[idx];
        marker.setPopupContent(getPopupContent(galerias[idx]));
        marker.openPopup();
        map.setView(marker.getLatLng(), 16);
      }
    });

    // Al abrir cualquier popup, actualizar contenido din치micamente
    map.on('popupopen', e => {
      const marker = e.popup._source;
      // Encontrar 칤ndice del marker para buscar la galer칤a
      const idx = markers.indexOf(marker);
      if (idx !== -1) {
        e.popup.setContent(getPopupContent(galerias[idx]));
      }
    });

    // Guardar para usar en toggle idioma
    window.galerias = galerias;
    window.markers = markers;
  })
  .catch(error => console.error('Error cargando galer칤as:', error));
</script>

<script>
let userMarker = null;

// Mostrar ubicaci칩n del usuario
if ("geolocation" in navigator) {
  navigator.geolocation.getCurrentPosition(position => {
    const userLat = position.coords.latitude;
    const userLng = position.coords.longitude;

    userMarker = L.circleMarker([userLat, userLng], {
      radius: 8,
      fillColor: "#3388ff",
      color: "#fff",
      weight: 2,
      opacity: 1,
      fillOpacity: 0.9
    }).addTo(map).bindPopup(currentLang === 'es' ? "Tu ubicaci칩n" : "Your location");

    map.setView([userLat, userLng], 14);
  }, error => {
    console.log("No se pudo obtener la ubicaci칩n: ", error.message);
  });
} else {
  console.log("Geolocalizaci칩n no est치 disponible en este navegador.");
}
</script>
</body>
</html>